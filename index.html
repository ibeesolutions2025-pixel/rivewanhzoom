<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PlantReview AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>

    <style>
      body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
      .animate-in { animation: fadeIn 0.5s ease-out forwards; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState } from 'react';
        import ReactDOM from 'react-dom/client';
        import { Leaf, Sparkles, Loader2, Play, CheckCircle, ChevronRight, Share2, Download, Video, History, Plus, Trash2, Image as ImageIcon, Upload, X } from 'lucide-react';

        const STYLES = [
            { id: 'educational', label: 'Kiến thức', desc: 'Sâu sắc, tỉ mỉ' },
            { id: 'enthusiastic', label: 'Hào hứng', desc: 'Năng lượng cao' },
            { id: 'relaxing', label: 'Thư giãn', desc: 'Nhẹ nhàng, chill' },
            { id: 'quick', label: 'Ngắn gọn', desc: 'Nhanh, súc tích' }
        ];

        const App = () => {
            const [step, setStep] = useState(1);
            const [selectedStyle, setSelectedStyle] = useState('educational');
            const [isProcessing, setIsProcessing] = useState(false);
            const [scenes, setScenes] = useState([{ id: 1, text: '', image: null }]); // image giờ lưu URL blob

            const addScene = () => setScenes([...scenes, { id: Date.now(), text: '', image: null }]);
            
            const removeScene = (id) => {
                setScenes(scenes.filter(s => s.id !== id));
            };

            const updateSceneText = (id, text) => {
                setScenes(scenes.map(s => s.id === id ? { ...s, text } : s));
            };

            // --- XỬ LÝ UPLOAD ẢNH (TẠO URL TẠM THỜI) ---
            const handleImageUpload = (id, event) => {
                const file = event.target.files[0];
                if (file) {
                    const imageUrl = URL.createObjectURL(file);
                    setScenes(scenes.map(s => s.id === id ? { ...s, image: imageUrl } : s));
                }
            };

            const removeImage = (id) => {
                setScenes(scenes.map(s => s.id === id ? { ...s, image: null } : s));
            };

            const handleProcess = () => {
                if (!scenes[0].text && !scenes[0].image) {
                    alert("Vui lòng nhập nội dung hoặc tải ảnh cho cảnh 1!");
                    return;
                }
                setIsProcessing(true);
                setTimeout(() => {
                    setIsProcessing(false);
                    setStep(2);
                }, 2000);
            };

            // --- GIAO DIỆN BƯỚC 1 ---
            const renderBuildStep = () => (
                <div className="space-y-8 animate-in">
                     <div className="text-center space-y-2">
                        <h2 className="text-3xl md:text-4xl font-extrabold text-slate-900">Kể chuyện về cây của bạn</h2>
                        <p className="text-slate-500">Thêm ảnh thực tế và gợi ý kịch bản review chân thực.</p>
                    </div>

                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <h3 className="font-semibold text-slate-800 mb-4 flex items-center gap-2">
                            <Sparkles size={18} className="text-green-500" />
                            Chọn phong cách review
                        </h3>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                            {STYLES.map(style => (
                                <button
                                    key={style.id}
                                    onClick={() => setSelectedStyle(style.id)}
                                    className={`p-3 rounded-xl border-2 transition-all text-center ${
                                        selectedStyle === style.id 
                                        ? 'border-green-600 bg-green-50 shadow-inner' 
                                        : 'border-slate-100 hover:border-slate-200 bg-slate-50/50'
                                    }`}
                                >
                                    <div className={`text-sm font-bold mb-0.5 ${selectedStyle === style.id ? 'text-green-700' : 'text-slate-600'}`}>
                                        {style.label}
                                    </div>
                                    <div className="text-[10px] text-slate-400">{style.desc}</div>
                                </button>
                            ))}
                        </div>
                    </div>

                    <div className="space-y-4">
                        <h3 className="font-semibold text-slate-800 flex items-center gap-2 ml-1">
                            <Video size={18} className="text-green-500" />
                            Thiết kế từng phân cảnh
                        </h3>
                        
                        {scenes.map((scene, index) => (
                            <div key={scene.id} className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm relative group animate-in">
                                <div className="flex justify-between items-center mb-3">
                                    <span className="text-xs font-bold text-slate-400 uppercase">PHÂN CẢNH {index + 1}</span>
                                    {scenes.length > 1 && (
                                        <button onClick={() => removeScene(scene.id)} className="text-slate-300 hover:text-red-500 transition">
                                            <Trash2 size={16} />
                                        </button>
                                    )}
                                </div>
                                <div className="flex flex-col md:flex-row gap-4">
                                    
                                    {/* --- KHU VỰC UPLOAD ẢNH (ĐÃ SỬA) --- */}
                                    <div className="w-full md:w-40 aspect-square flex-shrink-0">
                                        {scene.image ? (
                                            <div className="w-full h-full relative rounded-lg overflow-hidden border border-slate-200 group/img">
                                                <img src={scene.image} className="w-full h-full object-cover" />
                                                <button 
                                                    onClick={() => removeImage(scene.id)}
                                                    className="absolute top-1 right-1 bg-black/50 text-white p-1 rounded-full hover:bg-red-500 transition"
                                                >
                                                    <X size={14} />
                                                </button>
                                            </div>
                                        ) : (
                                            <label className="w-full h-full bg-slate-50 rounded-lg border-2 border-dashed border-slate-300 flex flex-col items-center justify-center cursor-pointer hover:border-green-500 hover:bg-green-50 transition-colors">
                                                <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm mb-2 text-green-600">
                                                    <Upload size={20} />
                                                </div>
                                                <span className="text-[10px] font-bold text-slate-500">Tải ảnh lên</span>
                                                <span className="text-[9px] text-slate-400 mt-1">PNG, JPG</span>
                                                <input 
                                                    type="file" 
                                                    accept="image/*" 
                                                    className="hidden" 
                                                    onChange={(e) => handleImageUpload(scene.id, e)}
                                                />
                                            </label>
                                        )}
                                    </div>
                                    
                                    <div className="flex-1">
                                        <textarea 
                                            placeholder="Ví dụ: Giới thiệu về màu lá, nói về việc cây mới mua về rất tươi..."
                                            className="w-full h-full min-h-[120px] p-3 text-sm border border-slate-200 rounded-lg bg-slate-50 focus:bg-white focus:border-green-500 focus:ring-1 focus:ring-green-500 outline-none resize-none"
                                            value={scene.text}
                                            onChange={(e) => updateSceneText(scene.id, e.target.value)}
                                        ></textarea>
                                    </div>
                                </div>
                            </div>
                        ))}

                        <button onClick={addScene} className="w-full py-3 border-2 border-dashed border-slate-300 rounded-xl text-slate-500 font-bold hover:border-green-500 hover:text-green-600 hover:bg-green-50 transition flex items-center justify-center gap-2">
                            <Plus size={18} /> Thêm cảnh mới
                        </button>
                    </div>

                    <div className="sticky bottom-4 z-10">
                        <button
                            onClick={handleProcess}
                            disabled={isProcessing}
                            className="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold shadow-xl hover:bg-black disabled:bg-slate-400 transition-all flex items-center justify-center gap-2"
                        >
                            {isProcessing ? (
                                <><Loader2 className="animate-spin" /> AI đang xử lý...</>
                            ) : (
                                <><Video /> Tạo Video Review</>
                            )}
                        </button>
                    </div>
                </div>
            );

            // --- GIAO DIỆN BƯỚC 2: KẾT QUẢ ---
            const renderResultStep = () => (
                <div className="space-y-6 animate-in">
                    <div className="text-center">
                        <h2 className="text-3xl font-bold text-slate-900">Video Demo Đã Tạo!</h2>
                        <p className="text-green-600">Phong cách: {STYLES.find(s => s.id === selectedStyle)?.label}</p>
                    </div>

                    <div className="max-w-xs mx-auto aspect-[9/16] bg-black rounded-2xl overflow-hidden relative shadow-2xl group cursor-pointer">
                        <div className="absolute inset-0 flex items-center justify-center">
                             <Play size={48} className="text-white opacity-80 group-hover:scale-110 transition-transform" />
                        </div>
                        {/* Hiển thị ảnh đầu tiên user đã upload */}
                        {scenes[0].image && <img src={scenes[0].image} className="w-full h-full object-cover opacity-60" />}
                        <div className="absolute bottom-4 left-4 right-4 text-center">
                             <p className="text-white text-sm font-medium drop-shadow-md">"{scenes[0].text || 'Nội dung demo...'}"</p>
                        </div>
                    </div>

                    <div className="flex gap-3">
                        <button onClick={() => setStep(1)} className="flex-1 py-3 border border-slate-300 bg-white rounded-xl font-bold text-slate-700 hover:bg-slate-50 flex items-center justify-center gap-2">
                            <History size={18}/> Làm lại
                        </button>
                        <button onClick={() => alert('Chức năng tải video cần backend!')} className="flex-1 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 flex items-center justify-center gap-2 shadow-lg shadow-green-200">
                            <Download size={18}/> Tải về
                        </button>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen pb-20">
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-20 shadow-sm">
                        <div className="max-w-4xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => setStep(1)}>
                                <div className="w-8 h-8 bg-green-600 rounded-lg flex items-center justify-center text-white">
                                    <Leaf size={18} />
                                </div>
                                <h1 className="font-bold text-lg text-slate-900">PlantReview <span className="text-green-600">AI</span></h1>
                            </div>
                             <div className="flex items-center gap-2 text-xs font-bold text-slate-400">
                                <span className={step === 1 ? 'text-green-600' : ''}>1. XÂY DỰNG</span>
                                <ChevronRight size={12} />
                                <span className={step === 2 ? 'text-green-600' : ''}>2. XUẤT VIDEO</span>
                             </div>
                        </div>
                    </header>

                    <main className="max-w-4xl mx-auto px-4 py-8">
                        {step === 1 ? renderBuildStep() : renderResultStep()}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
